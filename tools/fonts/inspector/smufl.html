<!DOCTYPE html>
<!-- 
  From the vexflow/ folder, run `npx serve` or some other http server.
  Then open http://localhost:5000/demos/fonts/showGlyphs.html in your browser.
  Click a glyph to log some information to the console.
-->
<html>
  <style>
    body {
      color: #ccc;
      background-color: #222;
      margin: 20px 20px 100px 20px;
    }

    .choose-font {
      text-align: center;
      margin-bottom: 10px;
    }
    .choose-font a {
      color: #8ab4f8;
      font: 20px system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Ubuntu, 'Helvetica Neue', Arial,
        sans-serif;
    }

    .item {
      color: #111;
      background-color: #f3f3f3;
      min-width: 100px;
      float: left;
      display: table;
      margin: 10px;
      padding: 0px;
      line-height: 3.2;
      font-size: 60px;
      text-align: center;
    }

    .clear {
      clear: both;
    }
  </style>
  <body>
    <div class="choose-font">
      <a id="bravura-link" href="#" onclick="setFont('Bravura'); return false;">Bravura</a> &nbsp;
      <a id="petaluma-link" href="#" onclick="setFont('Petaluma'); return false;">Petaluma</a>
    </div>
    <!--
    <a href="#" onclick="return false;">Gonville</a>
    TODO: Gonville is not a SMuFL font.
    We do not currently support viewing Gonville glyphs.
    See: src/fonts/legacy/glyphs.html for a Gonville glyph viewer.
    -->
    <div id="container"></div>
    <div class="clear">&nbsp;</div>
    <script type="module">
      // Each item is an array with:
      // - glyph name from the SMuFL specification: https://w3c.github.io/smufl/latest/tables/clefs.html
      // - unicode code point for SMuFL fonts (Bravura and Petaluma).
      // - unicode code point for Gonville font. This is null if the glyph is not available in the Gonville font.

      const response = await fetch('../config/glyphnames.json');
      const glyphNamesSMuFL = await response.json();

      // HACK to allow us to import a Node JS module. :-)
      window.module = {};
      await import('../config/valid_codes.js');
      const VALID_CODES = window.module.exports;
      window.module = {};

      // Load the three OTF files.
      const bravuraOTF = '../@/bravura/Bravura_1.392.otf';
      const bravura = new FontFace('Bravura', `url(${bravuraOTF}) format('opentype')`);
      await bravura.load();
      document.fonts.add(bravura);
      const petalumaOTF = '../@/petaluma/Petaluma_1.065.otf';
      const petaluma = new FontFace('Petaluma', `url(${petalumaOTF}) format('opentype')`);
      await petaluma.load();
      document.fonts.add(petaluma);
      const gonvilleOTF = '../@/gonville/Gonville-18_20200703.otf';
      const gonville = new FontFace('Gonville', `url(${gonvilleOTF}) format('opentype')`);
      await gonville.load();
      document.fonts.add(gonville);

      // Render all SMUFL glyphs.
      const container = document.getElementById('container');

      for (const glyphName in VALID_CODES) {
        const glyphInfo = glyphNamesSMuFL[glyphName];
        if (!glyphInfo) {
          // Skip `vexAccidentalMicrotonal1` and other glyph names that do not exist in SMuFL.
          console.log('Skipping ' + glyphName);
          continue;
        }

        const item = document.createElement('div');
        item.classList.add('item');
        const codePointHexString = glyphInfo.codepoint.replace('U+', '0x');
        const codePoint = parseInt(codePointHexString);
        glyphInfo.codepointValue = codePoint;
        item.innerText = String.fromCodePoint(codePoint);
        item.title = glyphInfo.description;
        glyphInfo.glyphName = glyphName;
        item.addEventListener('click', () => {
          console.log(glyphInfo);
        });
        container.appendChild(item);
      }

      window.setFont = (fontName) => {
        container.style.fontFamily = fontName;
        document.querySelectorAll('.choose-font a').forEach((anchor) => {
          anchor.style.fontWeight = 'normal';
          anchor.style.fontVariant = 'normal';
        });
        document.getElementById(`${fontName.toLowerCase()}-link`).style.fontWeight = 'bold';
        document.getElementById(`${fontName.toLowerCase()}-link`).style.fontVariant = 'small-caps';
      };

      setFont('Bravura');
    </script>
  </body>
</html>
