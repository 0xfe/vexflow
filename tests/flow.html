<!DOCTYPE html>
<html>
  <head>
    <title>VexFlow - JavaScript Music Notation and Guitar Tab</title>
    <link rel="stylesheet" href="flow.css" type="text/css" media="screen" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@500&display=swap" rel="stylesheet" />
    <!-- Test Dependencies: jQuery, QUnit -->
    <link rel="stylesheet" href="support/qunit.css" type="text/css" media="screen" />
    <script src="support/jquery.js"></script>
    <script src="support/qunit.js"></script>
    <script>
      function loadScript(url) {
        return new Promise(function (resolve, reject) {
          var script = document.createElement('script');
          script.onload = resolve;
          script.onerror = reject;
          script.src = url;
          // The utf-8 charset is required for the measureText cache,
          // since the index contains weird unicode characters.
          script.charset = 'utf-8';
          document.getElementsByTagName('head')[0].appendChild(script);
        });
      }

      $(function () {
        // Support a query param to choose which VexFlow version to load.
        // ver=(build|reference|releases|etc...)
        // If omitted, ver defaults to 'build'.
        var params = new URLSearchParams(window.location.search);
        var param_ver = params.get('ver');

        var vexURL;
        var testsURL;
        var isCurrentBuild = false;

        // ver can also specify a version hosted on unpkg.com:
        //   ver=unpkg@3.0.9  or  ver=unpkg@1.2.77
        // https://unpkg.com/vexflow@3.0.9/releases/vexflow-debug.js
        if (param_ver && param_ver.includes('unpkg')) {
          var version = param_ver.split('@')[1];
          vexURL = `https://unpkg.com/vexflow@${version}/releases/vexflow-debug.js`;
          testsURL = `https://unpkg.com/vexflow@${version}/releases/vexflow-tests.js`;
        } else {
          var path = param_ver || 'build';
          if (path === 'build') {
            isCurrentBuild = true;
          }
          vexURL = '../' + path + '/vexflow-debug.js';
          testsURL = '../' + path + '/vexflow-tests.js';
        }

        // Display which VexFlow version we loaded, if the `ver` param was specified.
        var info = param_ver !== null ? ` [${param_ver}]` : '';
        $('#vex-src')
          .attr('href', vexURL)
          .text('VexFlow Source' + info);

        const runTests = () => {
          // Show only failed tests.
          QUnit.config.hidepassed = true;
          QUnit.config.noglobals = true;
          Vex.Flow.Test.run();
        };

        if (isCurrentBuild) {
          // When loading the current version, only load vexflow-tests.js
          loadScript(testsURL).then(runTests);
        } else {
          // When loading previous versions, load both vexflow-debug.js and vexflow-tests.js
          loadScript(vexURL)
            .then(() => loadScript(testsURL))
            .then(runTests);
        }
      });
    </script>
  </head>

  <body>
    <div style="text-align: center">
      <div id="qunit"></div>
      <div id="qunit-fixture"></div>
      <div>
        <h2>[ <a href="http://vexflow.com">Home</a> ] [ <a href="http://github.com/0xfe/vexflow">GitHub</a> ]</h2>
        <h3>
          See the: <a id="vex-src" target="_blank"></a>. Don't forget to run the
          <a href="https://github.com/0xfe/vexflow/wiki/Visual-Regression-Tests">Visual Regression Tests</a>!
        </h3>
      </div>
      <p>&nbsp;</p>
      <div id="vexflow_testoutput"></div>
      <p>&nbsp;</p>
      <p class="vf-footer">
        [ <a href="http://vexflow.com">home</a> ] [ <a href="http://github.com/0xfe/vexflow">github</a> ] [
        <a href="http://0xfe.muthanna.com">0xfe</a> ]
      </p>
    </div>
  </body>
</html>
